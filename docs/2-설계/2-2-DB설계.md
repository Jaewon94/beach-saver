# 2-2 DB 설계서

## 1. 개요

- 본 문서는 Beach-Saver 시스템의 데이터베이스 구조(ERD), 테이블/컬럼 정의, 관계, 인덱스, 샘플 데이터, 품질/보안 정책 등을 명시한다.

## 2. ERD(개체-관계 다이어그램)

- [ERD 다이어그램: docs/2-설계/2-2-DB설계-erd.png]
- 주요 엔터티/관계 요약:
  - **User**(사용자) - 여러 **Team**에 소속, 여러 **Report** 작성
  - **Organization**(조직) - 여러 **Team**/User 소속
  - **Team**(팀) - 여러 User/Report 소속
  - **Report**(보고서) - User/Team/CollectionPoint와 연결
  - **CollectionPoint**(집하장) - 여러 Report와 연결
  - **Notification**(알림) - User와 연결
  - **Log**(로그) - User/시스템 이벤트 기록

## 3. 테이블/컬럼 정의

### 3-1. Enum/공통 코드 정의

| 코드명              | 값                   | 설명                                      | 비고   |
| ------------------- | -------------------- | ----------------------------------------- | ------ |
| user_role           | PlatformAdmin        | 플랫폼 전체 관리자                        |        |
|                     | CityAdmin            | 시/도 관리자                              |        |
|                     | DistrictAdmin        | 구/군 관리자                              |        |
|                     | Investigator         | 조사자                                    |        |
|                     | Cleaner              | 청소자                                    |        |
|                     | Collector            | 수거자                                    |        |
|                     | Citizen              | 시민 자원봉사자                           |        |
| user_status         | ACTIVE               | 활성                                      | 기본값 |
|                     | SUSPENDED            | 정지                                      |        |
|                     | WITHDRAWN            | 탈퇴                                      |        |
| report_type         | Investigation        | 조사 보고서                               |        |
|                     | Cleaning             | 청소 보고서                               |        |
|                     | Collection_Request   | 수거용(요청) 보고서(청소자 작성)          |
|                     | Collection_Completed | 수거완료(전체 완료) 보고서(수거자 선택적) |
| report_status       | DRAFT                | 임시                                      | 기본값 |
|                     | SUBMITTED            | 제출                                      |        |
|                     | APPROVED             | 승인                                      |        |
|                     | REJECTED             | 반려                                      |        |
| image_type          | INVESTIGATION_MAIN   | 조사 메인 이미지                          |        |
|                     | INVESTIGATION_AREA   | 조사 구역 이미지                          |        |
|                     | CLEANING_BEFORE_AREA | 청소 전 구역 이미지                       |
|                     | CLEANING_AFTER_AREA  | 청소 후 구역 이미지                       |
|                     | COLLECTION_DEPOT     | 집하장(포인트) 이미지                     |
|                     | COLLECTION_COMPLETED | 수거 완료 이미지                          |
| notification_type   | PUSH                 | 푸시 알림                                 |        |
|                     | SMS                  | 문자                                      |        |
|                     | EMAIL                | 이메일                                    |        |
| notification_status | UNREAD               | 안읽음                                    | 기본값 |
|                     | READ                 | 읽음                                      |        |

### 3-2. 공통 컬럼/정책

| 컬럼명     | 타입        | 기본값/정책        | 설명                    |
| ---------- | ----------- | ------------------ | ----------------------- |
| created_at | DATETIME    | DEFAULT NOW()      | 생성일시                |
| updated_at | DATETIME    |                    | 수정일시                |
| status     | VARCHAR(20) | 테이블별 enum 적용 | 상태(활성/정지/탈퇴 등) |
| type       | VARCHAR(20) | 테이블별 enum 적용 | 유형(보고서/알림 등)    |

### user

| 컬럼명     | 타입         | PK  | FK  | 제약조건         | 설명                                                                                   |
| ---------- | ------------ | --- | --- | ---------------- | -------------------------------------------------------------------------------------- |
| id         | BIGINT       | Y   |     | AUTO_INCREMENT   | 사용자 고유 ID                                                                         |
| system_id  | VARCHAR(50)  |     |     | UNIQUE NOT NULL  | 시스템 자동 생성 ID(내부 식별자, 로그인/감사/통계용, 예: BSJ001\_홍길동\_CLEANER_0025) |
| nickname   | VARCHAR(50)  |     |     |                  | 사용자가 입력하는 닉네임(표시명, 중복 허용, 화면 표시용)                               |
| phone      | VARCHAR(20)  |     |     | UNIQUE           | 휴대폰 번호(로그인/식별자)                                                             |
| password   | VARCHAR(255) |     |     | NOT NULL         | 비밀번호(암호화)                                                                       |
| role       | VARCHAR(20)  |     |     | NOT NULL         | 역할(PlatformAdmin/CityAdmin/DistrictAdmin/Investigator/Cleaner/Collector/Citizen)     |
| org_id     | BIGINT       |     | Y   |                  | 소속 조직 FK                                                                           |
| status     | VARCHAR(20)  |     |     | DEFAULT 'ACTIVE' | 계정 상태                                                                              |
| created_at | DATETIME     |     |     | DEFAULT NOW()    | 생성일시                                                                               |
| updated_at | DATETIME     |     |     |                  | 수정일시                                                                               |

**설명:**

- system_id: 시스템 자동 생성 ID(내부 식별자, 로그인/감사/통계/운영 기준, UNIQUE, 정책상 ID 직접 입력 없음)
- nickname: 사용자가 입력하는 표시명(중복 허용, 화면/알림/통계 등 표시용)
- phone: 로그인/식별자(UNIQUE, "휴대폰+인증번호" 정책)
- 정책상 ID/닉네임/로그인/식별자 역할을 명확히 분리, 혼동 방지

### user_team (N:M 관계, 팀 이력/역할 관리)

| 컬럼명       | 타입        | PK  | FK  | 제약조건         | 설명                 |
| ------------ | ----------- | --- | --- | ---------------- | -------------------- |
| user_id      | BIGINT      | Y   | Y   |                  | 사용자 FK            |
| team_id      | BIGINT      | Y   | Y   |                  | 팀 FK                |
| joined_at    | DATETIME    | Y   |     | DEFAULT NOW()    | 팀 소속 시작일       |
| left_at      | DATETIME    |     |     |                  | 팀 소속 종료일(탈퇴) |
| role_in_team | VARCHAR(20) |     |     |                  | 팀 내 역할(선택)     |
| status       | VARCHAR(20) |     |     | DEFAULT 'ACTIVE' | 소속 상태            |

**설명:**

- PK: (user_id, team_id, joined_at) → 한 사용자가 동일 팀에 여러 번 소속될 수 있는 이력 관리 구조(재가입/재배정 이력 추적)
- 단순 "현재 소속"만 필요하면 (user_id, team_id) PK + status/기간 관리도 가능하나, 실무적 이력 관리가 중요하므로 현 구조 유지

### user_admin (Admin/관리자 특화)

| 컬럼명     | 타입        | PK  | FK  | 제약조건 | 설명          |
| ---------- | ----------- | --- | --- | -------- | ------------- |
| user_id    | BIGINT      | Y   | Y   |          | user FK       |
| work_city  | VARCHAR(20) |     |     |          | 일하는 지역   |
| work_place | VARCHAR(40) |     |     |          | 근무처        |
| department | VARCHAR(20) |     |     |          | 부서          |
| position   | VARCHAR(20) |     |     |          | 직급          |
| contact    | VARCHAR(20) |     |     | UNIQUE   | 근무처 연락처 |

**설명:**

- 관리자(행정 담당자) 특화 정보(근무지, 부서, 직급, 담당구역 등) 관리.
- user 테이블과 1:1 관계, 실무적으로 조직/행정구역별 권한 분리/운영에 활용.

### user_worker (Worker/근로자 특화)

| 컬럼명           | 타입   | PK  | FK  | 제약조건 | 설명        |
| ---------------- | ------ | --- | --- | -------- | ----------- |
| user_id          | BIGINT | Y   | Y   |          | user FK     |
| vehicle_capacity | DOUBLE |     |     |          | 차량정보    |
| birth            | DATE   |     |     |          | 생년월일    |
| start_date       | DATE   |     |     |          | 근무 시작일 |
| end_date         | DATE   |     |     |          | 근무 종료일 |

**설명:**

- 근로자(조사자/청소자/수거자) 특화 정보(차량, 근무기간, 생년월일 등) 관리.
- user 테이블과 1:1 관계, 실무적으로 배정/스케줄/이력 관리에 활용.

### organization

| 컬럼명     | 타입         | PK  | FK  | 제약조건       | 설명                             |
| ---------- | ------------ | --- | --- | -------------- | -------------------------------- |
| id         | BIGINT       | Y   |     | AUTO_INCREMENT | 조직 고유 ID                     |
| name       | VARCHAR(100) |     |     | NOT NULL       | 조직명(시/구/군 등)              |
| type       | VARCHAR(20)  |     |     | NOT NULL       | 조직유형(Platform/City/District) |
| parent_id  | BIGINT       |     | Y   |                | 상위 조직 FK(선택)               |
| created_at | DATETIME     |     |     | DEFAULT NOW()  | 생성일시                         |

**설명:**

- 시/도/구/군 등 조직 단위 관리, 상위-하위 조직 구조 지원.
- 팀/사용자/집하장 등과 연계, 실무적으로 RBAC/운영/통계 단위로 활용.

### team

| 컬럼명     | 타입        | PK  | FK  | 제약조건       | 설명            |
| ---------- | ----------- | --- | --- | -------------- | --------------- |
| id         | BIGINT      | Y   |     | AUTO_INCREMENT | 팀 고유 ID      |
| name       | VARCHAR(50) |     |     | NOT NULL       | 팀명            |
| org_id     | BIGINT      |     | Y   |                | 소속 조직 FK    |
| leader_id  | BIGINT      |     | Y   |                | 팀장(사용자) FK |
| created_at | DATETIME    |     |     | DEFAULT NOW()  | 생성일시        |

**설명:**

- 실무 단위(팀) 관리, 조직/팀장/생성일 등 정보 포함.
- 사용자와 N:M 관계(user_team), 팀장 지정, 실무적으로 프로젝트/현장 단위 운영에 활용.

### collection_point

| 컬럼명     | 타입          | PK  | FK  | 제약조건       | 설명           |
| ---------- | ------------- | --- | --- | -------------- | -------------- |
| id         | BIGINT        | Y   |     | AUTO_INCREMENT | 집하장 고유 ID |
| name       | VARCHAR(100)  |     |     | NOT NULL       | 집하장명       |
| address    | VARCHAR(255)  |     |     |                | 주소           |
| latitude   | DECIMAL(10,7) |     |     |                | 위도           |
| longitude  | DECIMAL(10,7) |     |     |                | 경도           |
| org_id     | BIGINT        |     | Y   |                | 소속 조직 FK   |
| created_at | DATETIME      |     |     | DEFAULT NOW()  | 생성일시       |

**설명:**

- 집하장(쓰레기 수거 지점) 정보 관리, 조직/위치/주소 등 포함.
- 보고서와 연계, 실무적으로 수거/운영/통계 단위로 활용.

### report (공통)

| 컬럼명     | 타입          | PK  | FK  | 제약조건        | 설명                               |
| ---------- | ------------- | --- | --- | --------------- | ---------------------------------- |
| id         | BIGINT        | Y   |     | AUTO_INCREMENT  | 보고서 고유 ID                     |
| type       | VARCHAR(20)   |     |     | NOT NULL        | 유형(조사/청소/수거용/수거완료 등) |
| user_id    | BIGINT        |     | Y   |                 | 대표 작성자/책임자 FK              |
| team_id    | BIGINT        |     | Y   |                 | 소속 팀 FK(선택)                   |
| status     | VARCHAR(20)   |     |     | DEFAULT 'DRAFT' | 상태(임시/제출/승인/반려 등)       |
| gps_lat    | DECIMAL(10,7) |     |     |                 | GPS 위도                           |
| gps_lng    | DECIMAL(10,7) |     |     |                 | GPS 경도                           |
| content    | TEXT          |     |     |                 | 상세 내용                          |
| created_at | DATETIME      |     |     | DEFAULT NOW()   | 생성일시                           |
| updated_at | DATETIME      |     |     |                 | 수정일시                           |

**설명:**

- report.user_id가 각 보고서의 대표 작성자/책임자임
- type: 'Collection_Request'는 청소자가 작성하는 수거용(요청) 보고서, 'Collection_Completed'는 수거자가 전체 집하장 처리 완료 시 선택적으로 생성
- collection_id 컬럼은 제거(집하장 정보는 collection_depot에서 1:N 관리)

### report_investigation (메인 조사 보고서)

| 컬럼명           | 타입         | PK  | FK  | 설명               |
| ---------------- | ------------ | --- | --- | ------------------ |
| report_id        | BIGINT       | Y   | Y   | report FK          |
| beach_id         | BIGINT       |     | Y   | 해변 FK (beach)    |
| investigation_at | DATETIME     |     |     | 조사 일시          |
| disaster_type    | VARCHAR(20)  |     |     | 자연재해 유무/종류 |
| weather          | VARCHAR(20)  |     |     | 날씨(자동/수동)    |
| note             | VARCHAR(255) |     |     | 특이사항/비고      |
| created_at       | DATETIME     |     |     | DEFAULT NOW()      |
| updated_at       | DATETIME     |     |     |                    |

**설명:**

- beach_id: beach.id FK로 변경(전국 확장/고유성 보장)
- report.user_id가 조사자(대표 작성자) 역할

### report_investigation_area (구역별/서브 조사 보고서)

| 컬럼명           | 타입          | PK  | FK  | 설명                         |
| ---------------- | ------------- | --- | --- | ---------------------------- |
| id               | BIGINT        | Y   |     | 구역 조사 고유 ID            |
| report_id        | BIGINT        |     | Y   | 메인 조사 보고서 FK          |
| area_name        | VARCHAR(100)  |     |     | 구역명/구간명                |
| start_latitude   | DECIMAL(10,7) |     |     | 구역 시작 위도               |
| start_longitude  | DECIMAL(10,7) |     |     | 구역 시작 경도               |
| end_latitude     | DECIMAL(10,7) |     |     | 구역 끝 위도                 |
| end_longitude    | DECIMAL(10,7) |     |     | 구역 끝 경도                 |
| trash_amount_est | INTEGER       |     |     | 예상 쓰레기 양(리터/개수 등) |
| main_trash_type  | VARCHAR(50)   |     |     | 주 쓰레기 종류               |
| note             | VARCHAR(255)  |     |     | 구역 특이사항/비고           |
| created_at       | DATETIME      |     |     | DEFAULT NOW()                |
| updated_at       | DATETIME      |     |     |                              |

### report_cleaning (메인 청소 보고서)

| 컬럼명                  | 타입         | PK  | FK  | 설명                             |
| ----------------------- | ------------ | --- | --- | -------------------------------- |
| report_id               | BIGINT       | Y   | Y   | report FK                        |
| investigation_report_id | BIGINT       |     | Y   | 연계된 조사 메인 보고서 FK(선택) |
| beach_id                | BIGINT       |     | Y   | 해변 FK (beach)                  |
| cleaning_at             | DATETIME     |     |     | 청소 일시                        |
| weather                 | VARCHAR(20)  |     |     | 날씨(자동/수동)                  |
| note                    | VARCHAR(255) |     |     | 특이사항/비고                    |
| created_at              | DATETIME     |     |     | DEFAULT NOW()                    |
| updated_at              | DATETIME     |     |     |                                  |

**설명:**

- beach_id: beach.id FK로 변경(전국 확장/고유성 보장)
- report.user_id가 청소팀장(대표 작성자) 역할

### report_cleaning_area (구역별/서브 청소 보고서)

| 컬럼명                | 타입          | PK  | FK  | 설명                                |
| --------------------- | ------------- | --- | --- | ----------------------------------- |
| id                    | BIGINT        | Y   |     | 구역 청소 고유 ID                   |
| report_id             | BIGINT        |     | Y   | 메인 청소 보고서 FK                 |
| investigation_area_id | BIGINT        |     | Y   | 연계된 조사 구역별 FK(선택)         |
| area_name             | VARCHAR(100)  |     |     | 구역명/구간명                       |
| start_latitude        | DECIMAL(10,7) |     |     | 구역 시작 위도                      |
| start_longitude       | DECIMAL(10,7) |     |     | 구역 시작 경도                      |
| end_latitude          | DECIMAL(10,7) |     |     | 구역 끝 위도                        |
| end_longitude         | DECIMAL(10,7) |     |     | 구역 끝 경도                        |
| trash_amount          | INTEGER       |     |     | 실제 수거 쓰레기 양                 |
| main_trash_type       | VARCHAR(50)   |     |     | 주 쓰레기 종류                      |
| before_image_id       | BIGINT        |     | Y   | 청소 전 사진(report_image FK, 선택) |
| after_image_id        | BIGINT        |     | Y   | 청소 후 사진(report_image FK, 선택) |
| note                  | VARCHAR(255)  |     |     | 구역 특이사항/비고                  |
| created_at            | DATETIME      |     |     | DEFAULT NOW()                       |
| updated_at            | DATETIME      |     |     |                                     |

참고:

- investigation_report_id: 이 청소 보고서가 어떤 조사 보고서를 기반으로 생성됐는지 추적
- investigation_area_id: 이 청소 구역이 어떤 조사 구역을 기반으로 생성됐는지 추적
- 조사-청소간 데이터 연계/이력/관계 추적 가능

### report_collection (수거자 입력, 1:N 구조)

| 컬럼명           | 타입          | PK  | FK  | 설명                 |
| ---------------- | ------------- | --- | --- | -------------------- |
| id               | BIGINT        | Y   |     | 수거 보고서 고유 ID  |
| report_id        | BIGINT        |     | Y   | 공통 보고서 FK       |
| collected_amount | INTEGER       |     |     | 수거량(kg 등)        |
| collection_time  | DATETIME      |     |     | 수거일시             |
| collector_id     | BIGINT        |     | Y   | 수거자(작업자) FK    |
| collector_note   | VARCHAR(255)  |     |     | 수거 특이사항/비고   |
| collection_lat   | DECIMAL(10,7) |     |     | 수거 위치 위도(선택) |
| collection_lng   | DECIMAL(10,7) |     |     | 수거 위치 경도(선택) |
| created_at       | DATETIME      |     |     | DEFAULT NOW()        |
| updated_at       | DATETIME      |     |     |                      |

참고:

- report(공통) 1 : N report_collection 구조
- 한 공통 보고서에 여러 수거 이력/결과 기록 가능(부분 수거, 재수거 등)
- 수거자/수거일시/위치 등 이력 관리 및 다중 수거자 지원

### report_completed (수거완료 보고서 특화)

| 컬럼명        | 타입         | PK  | FK  | 제약조건 | 설명                                   |
| ------------- | ------------ | --- | --- | -------- | -------------------------------------- |
| report_id     | BIGINT       | Y   | Y   |          | report FK                              |
| collection_id | BIGINT       |     | Y   |          | 수거용 보고서 FK(report_collection.id) |
| completed_by  | BIGINT       |     | Y   |          | 수거 완료자(수거자) FK                 |
| completed_at  | DATETIME     |     |     |          | 수거 완료 시각                         |
| comment       | VARCHAR(255) |     |     |          | 완료 코멘트                            |
| image_id      | BIGINT       |     | Y   |          | 완료 사진 FK                           |

**설명:**

- 수거자가 각 집하장별로 수거 완료 시 생성, report_collection과 1:1 또는 1:N 관계
- 완료자, 완료 시각, 코멘트, 사진 등 이력/감사/통계용 정보 포함

### notification

| 컬럼명     | 타입         | PK  | FK  | 제약조건         | 설명                     |
| ---------- | ------------ | --- | --- | ---------------- | ------------------------ |
| id         | BIGINT       | Y   |     | AUTO_INCREMENT   | 알림 고유 ID             |
| user_id    | BIGINT       |     | Y   |                  | 수신자 FK                |
| type       | VARCHAR(20)  |     |     | NOT NULL         | 유형(푸시/SMS/이메일 등) |
| title      | VARCHAR(100) |     |     |                  | 제목                     |
| message    | TEXT         |     |     |                  | 메시지 본문              |
| status     | VARCHAR(20)  |     |     | DEFAULT 'UNREAD' | 읽음/안읽음 상태         |
| created_at | DATETIME     |     |     | DEFAULT NOW()    | 생성일시                 |

**설명:**

- 사용자별 알림(PUSH/SMS/EMAIL 등) 관리, 상태(읽음/안읽음) 포함.
- 실무적으로 이벤트/상태 변화/운영 알림에 활용.

### log

| 컬럼명     | 타입        | PK  | FK  | 제약조건       | 설명                 |
| ---------- | ----------- | --- | --- | -------------- | -------------------- |
| id         | BIGINT      | Y   |     | AUTO_INCREMENT | 로그 고유 ID         |
| user_id    | BIGINT      |     | Y   |                | 관련 사용자 FK(선택) |
| action     | VARCHAR(50) |     |     | NOT NULL       | 이벤트/행동명        |
| detail     | TEXT        |     |     |                | 상세 내용            |
| created_at | DATETIME    |     |     | DEFAULT NOW()  | 생성일시             |

**설명:**

- 사용자/시스템 이벤트/행동 로그 관리, 상세 내용 포함.
- 실무적으로 보안/운영/감사/이력 추적에 필수.

### beach (해변)

| 컬럼명                     | 타입        | PK  | 제약조건       | 설명                  |
| -------------------------- | ----------- | --- | -------------- | --------------------- |
| id                         | BIGINT      | Y   | AUTO_INCREMENT | 해변 고유 ID          |
| org_id                     | BIGINT      |     | NOT NULL       | 소속 조직 FK          |
| beach_name                 | VARCHAR(50) |     | NOT NULL       | 해변명(조직 내 고유)  |
| si                         | VARCHAR(30) |     | NOT NULL       | 시                    |
| gu_gun                     | VARCHAR(30) |     | NOT NULL       | 구/군                 |
| dong_eub                   | VARCHAR(30) |     | NOT NULL       | 동/읍                 |
| workplace                  | VARCHAR(30) |     | NOT NULL       | 근무처(행정구역 단위) |
| latitude                   | DOUBLE      |     | NOT NULL       | 위도                  |
| longitude                  | DOUBLE      |     | NOT NULL       | 경도                  |
| UNIQUE(org_id, beach_name) |             |     |                | 조직 내 해변명 유니크 |

**설명:**

- id(PK) + (org_id, beach_name) UNIQUE로 전국 확장/고유성 보장
- 기존 beach_name PK 구조에서 id PK로 전환, 모든 FK는 beach.id 참조로 일원화

### report_investigation_image (조사 보고서 이미지)

| 컬럼명      | 타입         | PK  | FK  | 설명                                                                         |
| ----------- | ------------ | --- | --- | ---------------------------------------------------------------------------- |
| id          | BIGINT       | Y   |     | 이미지 고유 ID                                                               |
| report_id   | BIGINT       |     | Y   | 조사 메인 보고서 FK                                                          |
| area_id     | BIGINT       |     | Y   | 조사 구역별 FK(report_investigation_area.id, 선택)                           |
| type        | VARCHAR(20)  |     |     | 사진 유형(Enum: 조사, 구역, BEFORE_CLEANING, AFTER_CLEANING, DEPOT_PHOTO 등) |
| file_name   | VARCHAR(255) |     |     | S3 파일명                                                                    |
| ord         | INTEGER      |     |     | 이미지 순서                                                                  |
| description | VARCHAR(255) |     |     | 사진 설명(선택)                                                              |

**설명:**

- area_id: report_investigation_area.id FK(구역별 이미지 시만 사용)
- type: Enum(image_type: 조사, 구역, BEFORE_CLEANING, AFTER_CLEANING, DEPOT_PHOTO 등)으로 관리

### report_cleaning_image (청소 보고서 이미지)

| 컬럼명      | 타입         | PK  | FK  | 설명                                          |
| ----------- | ------------ | --- | --- | --------------------------------------------- |
| id          | BIGINT       | Y   |     | 이미지 고유 ID                                |
| report_id   | BIGINT       |     | Y   | 청소 메인 보고서 FK                           |
| area_id     | BIGINT       |     | Y   | 청소 구역별 FK(report_cleaning_area.id, 선택) |
| type        | VARCHAR(20)  |     |     | 사진 유형(Enum: 청소전/후/구역 등)            |
| file_name   | VARCHAR(255) |     |     | S3 파일명                                     |
| ord         | INTEGER      |     |     | 이미지 순서                                   |
| description | VARCHAR(255) |     |     | 사진 설명(선택)                               |

**설명:**

- area_id: report_cleaning_area.id FK(구역별 이미지 시만 사용)
- type: Enum(image_type: BEFORE_CLEANING, AFTER_CLEANING, 구역 등)으로 관리

### collection_depot (집하장/포인트)

| 컬럼명                       | 타입          | PK  | FK  | 제약조건       | 설명                                                         |
| ---------------------------- | ------------- | --- | --- | -------------- | ------------------------------------------------------------ |
| id                           | BIGINT        | Y   |     | AUTO_INCREMENT | 집하장(포인트) 고유 ID                                       |
| collection_request_report_id | BIGINT        |     | Y   |                | 수거용(요청) 보고서 FK(report.id, type='Collection_Request') |
| name                         | VARCHAR(100)  |     |     |                | 집하장명                                                     |
| address                      | VARCHAR(255)  |     |     |                | 집하장 주소                                                  |
| latitude                     | DECIMAL(10,7) |     |     |                | 위도                                                         |
| longitude                    | DECIMAL(10,7) |     |     |                | 경도                                                         |
| photo_url                    | VARCHAR(255)  |     |     |                | 집하장 사진(S3 등)                                           |
| status                       | VARCHAR(20)   |     |     |                | 상태(Enum: 수거대기/수거완료/문제 등)                        |
| collector_id                 | BIGINT        |     | Y   |                | 수거자(수거 완료 처리자) FK                                  |
| collection_completed_at      | DATETIME      |     |     |                | 수거 완료 시각                                               |
| collected_amount             | INTEGER       |     |     |                | 수거량(kg 등)                                                |
| note                         | VARCHAR(255)  |     |     |                | 특이사항/비고                                                |
| created_at                   | DATETIME      |     |     | DEFAULT NOW()  | 생성일시                                                     |
| updated_at                   | DATETIME      |     |     |                | 수정일시                                                     |

**설명:**

- 청소자가 report(type='Collection_Request')를 생성하고, 여러 집하장(포인트) 정보를 collection_depot에 1:N으로 입력
- 수거자는 각 집하장별로 status/collector_id/collection_completed_at 등 상태를 업데이트(수거 완료 처리)
- 수거 완료 이력/상태/담당자/시각/수거량 등 모두 추적 가능
- 기존 report_collection/report_completed 테이블은 collection_depot 구조로 통합/대체
- 필요시 report(type='Collection_Completed')는 전체 집하장 처리 완료 시점의 최종 보고서로만 사용

## 관계(FK) 요약

- user.org_id → organization.id
- team.org_id → organization.id
- team.leader_id → user.id
- report.user_id → user.id
- report.team_id → team.id
- collection_point.org_id → organization.id
- notification.user_id → user.id
- log.user_id → user.id
- collection_depot.collection_request_report_id → report.id
- collection_depot.collector_id → user.id
- report_investigation_image.report_id → report.id
- report_investigation_image.area_id → report_investigation_area.id
- report_cleaning_image.report_id → report.id
- report_cleaning_image.area_id → report_cleaning_area.id

## 4. 인덱스/성능/품질 정책

- **주요 인덱스:**
  - user(phone), user(org_id), report(type), report(user_id), report(team_id), report(collection_id), notification(user_id), log(user_id)
- **유니크/복합 인덱스:**
  - user(phone), team(org_id, name), collection_point(org_id, name)
- **파티셔닝/샤딩:**
  - 대용량 보고서/로그 테이블은 날짜/조직 기준 파티셔닝 고려
- **데이터 품질:**
  - NOT NULL, UNIQUE, FK 제약조건 적극 활용
  - 논리 삭제(soft delete) 컬럼 필요시 추가

## 5. 샘플 데이터/DDL

### user 샘플 데이터

| id  | system_id                      | nickname | phone       | password | role          | org_id | status | created_at          |
| --- | ------------------------------ | -------- | ----------- | -------- | ------------- | ------ | ------ | ------------------- |
| 1   | PLATFORM\_관리자A_0001         | 관리자A  | 01012345678 | (암호화) | PlatformAdmin | 1      | ACTIVE | 2024-06-01 10:00:00 |
| 2   | BSJ001\_김시청\_CITYADMIN_0002 | 김시청   | 01023456789 | (암호화) | CityAdmin     | 2      | ACTIVE | 2024-06-01 10:10:00 |
| 3   | BSJ001\_홍길동\_CLEANER_0025   | 홍길동   | 01034567890 | (암호화) | Cleaner       | 2      | ACTIVE | 2024-06-01 10:20:00 |

### user_team 샘플 데이터

| user_id | team_id | joined_at           | left_at             | role_in_team | status |
| ------- | ------- | ------------------- | ------------------- | ------------ | ------ |
| 3       | 1       | 2024-06-01 10:20:00 | NULL                | MEMBER       | ACTIVE |
| 3       | 2       | 2024-07-01 09:00:00 | 2024-07-10 18:00:00 | LEADER       | LEFT   |
| 2       | 1       | 2024-06-01 10:10:00 | NULL                | MANAGER      | ACTIVE |

### user_admin 샘플 데이터

| user_id | work_city | work_place | department | position | contact    |
| ------- | --------- | ---------- | ---------- | -------- | ---------- |
| 1       | 서울      | 본사       | 운영팀     | 팀장     | 0212345678 |
| 2       | 부산      | 부산지사   | 관리팀     | 매니저   | 0512345678 |

### user_worker 샘플 데이터

| user_id | vehicle_capacity | birth      | start_date | end_date |
| ------- | ---------------- | ---------- | ---------- | -------- |
| 3       | 1.5              | 1990-01-01 | 2024-06-01 | NULL     |

### DDL 예시

```sql
CREATE TABLE user (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  system_id VARCHAR(50) UNIQUE NOT NULL,
  nickname VARCHAR(50),
  phone VARCHAR(20) UNIQUE,
  password VARCHAR(255) NOT NULL,
  role VARCHAR(20) NOT NULL,
  org_id BIGINT,
  status VARCHAR(20) DEFAULT 'ACTIVE',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME,
  FOREIGN KEY (org_id) REFERENCES organization(id)
);

CREATE TABLE user_team (
  user_id BIGINT,
  team_id BIGINT,
  joined_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  left_at DATETIME,
  role_in_team VARCHAR(20),
  status VARCHAR(20) DEFAULT 'ACTIVE',
  PRIMARY KEY (user_id, team_id, joined_at),
  FOREIGN KEY (user_id) REFERENCES user(id),
  FOREIGN KEY (team_id) REFERENCES team(id)
);

CREATE TABLE user_admin (
  user_id BIGINT PRIMARY KEY,
  work_city VARCHAR(20),
  work_place VARCHAR(40),
  department VARCHAR(20),
  position VARCHAR(20),
  contact VARCHAR(20) UNIQUE,
  FOREIGN KEY (user_id) REFERENCES user(id)
);

CREATE TABLE user_worker (
  user_id BIGINT PRIMARY KEY,
  vehicle_capacity DOUBLE,
  birth DATE,
  start_date DATE,
  end_date DATE,
  FOREIGN KEY (user_id) REFERENCES user(id)
);
```

### collection_depot_image (집하장 이미지)

| 컬럼명              | 타입         | PK  | FK  | 설명                                   |
| ------------------- | ------------ | --- | --- | -------------------------------------- |
| id                  | BIGINT       | Y   |     | 이미지 고유 ID                         |
| collection_depot_id | BIGINT       |     | Y   | 집하장(포인트) FK(collection_depot.id) |
| type                | VARCHAR(20)  |     |     | 이미지 유형(Enum: COLLECTION_DEPOT 등) |
| file_name           | VARCHAR(255) |     |     | S3 파일명                              |
| ord                 | INTEGER      |     |     | 이미지 순서                            |
| description         | VARCHAR(255) |     |     | 사진 설명(선택)                        |

**설명:**

- collection_depot(집하장/포인트)별로 여러 이미지 첨부가 필요한 경우 사용
- type은 image_type Enum(COLLECTION_DEPOT 등)으로 관리
- FK: collection_depot_id → collection_depot.id

## 6. 보안/개인정보/백업 정책

- **PII 처리:**
  - 최소한의 개인정보만 저장(실명, 전화번호 등)
  - 비밀번호/민감정보는 bcrypt 등 강력한 해시로 암호화
  - 개인정보 컬럼은 접근권한/로깅/마스킹 적용
- **암호화:**
  - 전송: 모든 API/DB 연결 HTTPS/TLS 적용
  - 저장: 비밀번호, 민감정보는 해시/암호화 저장
- **접근제어:**
  - RBAC 기반 DB 접근권한 분리(관리자/운영/개발 등)
  - DB 접근/변경 이력 로그 필수
- **백업/복구:**
  - RDS 자동 백업(일/주 단위), PITR(시점 복구)
  - S3/외부 저장소로 정기 백업, 백업 암호화/무결성 검증
  - 백업/복구 테스트 정기 수행

## 7. 문서 내 참고/링크

- [시스템 아키텍처: docs/2-설계/2-1-시스템아키텍처.md]
- [API 명세: docs/2-설계/2-3-API명세서.md]

## 전체 데이터 흐름 요약

1. **사용자/조직/팀 생성**
   - 관리자/근로자 등 사용자 등록 → 조직/팀 배정(user, organization, team, user_team)
2. **해변 등록**
   - 운영 대상 해변/포구/항구 등 등록(beach)
3. **조사/청소/수거 보고서 작성**
   - 조사 보고서(report_investigation, report_investigation_area) → 청소 보고서(report_cleaning, report_cleaning_area) → 수거용(요청) 보고서(report, type='Collection_Request') 및 집하장 정보(collection_depot) 등록(청소자) → 각 집하장별 수거 완료 처리(collection_depot 상태 업데이트 - 수거자)
   - 각 단계별로 해변(beach) FK로 연계, 구역별 상세 기록
4. **이미지/알림/로그 기록**
   - 각 보고서별 이미지(report_investigation_image 등), 알림(notification), 로그(log) 자동 기록
5. **통계/운영/백업**
   - 모든 데이터는 통계/운영/보안/백업 정책에 따라 관리, 실무적 확장/협업/운영에 최적화

- **실무적 주의/확장성:**
  - 역할/팀/보고서/이미지/이력 등 다중 연계, 대용량/협업/운영/보안까지 모두 고려된 구조
  - FK/PK/인덱스/품질 정책 적극 활용, 확장/변경 시 설계서-코드-운영 일치 필수
