# Beach-Saver 문서화 개요

> **본 문서 및 docs/ 하위의 모든 문서는 v1, v2(및 향후 버전)에서의 주요 내용, 변경 이력, 설계 의도, 개선점 등을 포괄적으로 기록·관리합니다.**
>
> - v1, v2 구분/비교, 변경점, 레거시/신규 설계 모두 포함될 수 있습니다.
> - 각 문서 내에 버전별 차이, 개선점, 마이그레이션 이슈 등도 명확히 기술할 예정입니다.
> - **현재는 부산시(부산 해안)에서만 시범/운영 중이며, 전국(타 지자체 등)으로 확장 가능한 구조/비전을 내재화하고 있습니다.**

## 프로젝트 소개

- 부산 해안을 대상으로 GPS 및 데이터 수집을 활용해 해양쓰레기를 수거하고, 빅데이터 기반으로 효율적 관리 및 정책 제안을 목표로 하는 환경 관리 플랫폼(현재는 부산시만 시범/운영)
- **관리 체계:**
  - 시청(부산시 등)이 superAdmin 역할을 하며, 각 구청이 regularAdmin으로서 관할 해안의 작업 범위와 작업자를 관리
  - 구청(regularAdmin)은 산하 작업자를 직접 등록/관리하며, 각 작업자는 모바일 앱을 통해 현장 업무를 수행
  - **작업자 역할은 '조사자', '청소자', '수거자'로 명확히 분리되며, 한 사람이 여러 역할을 하려면 각 역할별 별도 계정(아이디)로 로그인해야 함**
  - **수거자는 차량 필요 조건이 명확히 적용되며, 개인/업체 모두 가능(단, 업체/개인 구분 필드/권한/검증 필수)**
  - 이 구조는 실제 행정 조직의 위계와 현장 운영 방식을 반영하며, 책임/이력/정산/감사 등 모든 관리가 명확해지고 전국 확장, 외주/민간/공공 혼합 운영에도 유연함
- 현장 작업자(조사자/청소자/수거자)는 모바일(Native 앱, React Native) 환경에서 각 역할별 업무(보고서 작성, 청소, 수거 등)를 수행하고, 관리자는 데스크탑(Next.js 웹) 환경에서 통계·분석·작업/회원 관리를 수행
- **PWA(Progressive Web App)는 별도 도입하지 않으며, 역할별 앱/웹 완전 분리로 보안·권한·운영 효율성 극대화**
- JPA 기반 DB 자동화, Docker로 개발/운영 환경 통일, 데이터 기반 정책 지원 및 AI 예측 기능 확장 지향
- **현재는 부산시(부산 해안)에서만 시범/운영 중이나, 전국(타 지자체 등)으로 확장 가능한 구조/비전임을 모든 설계/운영에 반영**

## 사용자 역할 및 권한 체계

Beach-Saver 시스템의 모든 사용자는 아래와 같이 명확한 역할/권한/업무 기준에 따라 관리됩니다.

| 역할                 | 정의/자격                             | 주요 권한/업무                                          | 계정 생성/승인/전환 정책                              | 실무상 주의점/특이사항                                    |
| -------------------- | ------------------------------------- | ------------------------------------------------------- | ----------------------------------------------------- | --------------------------------------------------------- |
| PlatformAdmin        | 플랫폼 운영사(최고 관리자)            | 전체 조직/계정/정책/로그/통계 관리, 정책 변경           | 운영사에서 직접 생성/관리                             | 전국 확장, 정책/구조 변경, 전체 데이터 접근               |
| CityAdmin            | 시청 단위 관리자(예: 부산시청)        | 본인 시청 및 하위 구청/작업자 관리, 시청 단위 통계/감사 | PlatformAdmin이 생성/관리, 시청별 1명 이상            | 타 시청 데이터 접근 불가, 시청별 정책/실적 관리           |
| DistrictAdmin        | 구청 단위 관리자(예: 해운대구청)      | 본인 구청 및 하위 작업자 관리, 구청 단위 통계/감사      | CityAdmin이 생성/관리, 구청별 1명 이상                | 타 구청/시청 데이터 접근 불가, 구청별 실적/배정 관리      |
| 조사자(Investigator) | 행정기관/전문 인력(조사 담당)         | 현장 조사, 데이터 입력/수정                             | 관리자(구청) 직접 생성/배정, 시민 참여 불가           | 역할별 계정 분리, 시민은 조사자 역할 불가                 |
| 청소자(Cleaner)      | 정규(상시/계약) 또는 시민(자원봉사자) | 현장 청소, 데이터 입력/수정                             | 정규: 관리자 직접 생성/배정, 시민: 자가가입→승인→전환 | 시민은 자가가입→승인→청소자 전환만 가능, 역할별 계정 분리 |
| 수거자(Collector)    | 차량 필요, 업체/개인(구분/검증 필수)  | 수거/운반, 데이터 입력/수정                             | 관리자 직접 생성/검증(차량/업체/개인 구분 필수)       | 시민 참여 불가, 역할별 계정 분리, 차량/업체 검증 필수     |
| 자원봉사자(시민)     | 일반 시민(자가가입)                   | 청소 참여(승인 전 제한), 데이터 입력(승인 전 제한)      | 자가가입→임시계정→관리자 승인→청소자 전환             | 승인 전 제한, 조사자/수거자 역할 불가, 청소자만 전환 가능 |

- **역할별 계정(아이디) 분리 원칙:** 한 사람이 여러 역할을 하려면 각 역할별 별도 계정 필요(통합계정/역할전환 UI 없음)
- **시민(자원봉사자)은 '청소자' 역할로만 전환 가능, 조사자/수거자 역할은 시민에게 부여 불가**
- **수거자는 차량 필요, 업체/개인 구분/검증 필수**
- **모든 계정 생성/변경/승인/삭제 이력은 감사/보안/통계 목적으로 기록**
- **자세한 정책/예외/엣지케이스는 '1-1 프로젝트 개요(10. 계정 정책)' 및 각 정책 문서 참조**

## 관리자(Admin) 주요 업무/화면/UX 흐름

Beach-Saver의 관리자는 아래와 같이 **PlatformAdmin(플랫폼 운영사), CityAdmin(시청), DistrictAdmin(구청)** 세부 역할별로 명확히 분리·정의됩니다.

---

### 1. 공통 관리자 기능(Platform/City/District)

- **ID/비밀번호 직접 입력(2FA 등), 관리자 권한별 접근 제어** // [FR-1, FR-12, UC-3, NFR-2]
- **권한별(Platform/City/District) 메뉴/기능 자동 분기, 접근 로그 기록** // [FR-12, UC-3, NFR-2]
- **이중 승인/감사 로그, 권한 상승 방지** // [FR-1, FR-12, NFR-2]
- **오프라인 임시 저장/동기화(보고서/통계 등) 지원** // [NFR-9, FR-6, UC-1]
  - 예시: 현장 점검(해안 실사, 긴급 현장조치 등) 중 노트북/태블릿으로 보고서 초안 오프라인 작성, 사무실 복귀 후 온라인 동기화 및 제출. 대용량 통계/분석 데이터 오프라인 분석 후 복귀 시 일괄 업로드 등.
- **쉬운 안내/오류 메시지, 접근성(큰글씨/고대비)** // [NFR-3, 쉬운 안내/오류 메시지]
- (image: 관리자 로그인/권한 분기/오류 안내 와이어프레임) // [와이어프레임/목업]

---

### 2. PlatformAdmin(플랫폼 운영사)

- **전체 조직(모든 시청/구청/작업자/시민) 관리, 정책/구조/권한 변경** // [FR-12, UC-3, NFR-2]
- **전국 단위 정책/구조/권한/알림/운영/모니터링** // [FR-4, FR-13, NFR-7]
- **모든 데이터(계정/로그/통계/이력) 접근 및 감사/보안/이중 승인** // [FR-1, FR-12, NFR-2]
- **대용량 데이터 필터/검색, 전국 단위 통계/분석/대시보드** // [FR-4, FR-10, UC-4, NFR-9]
- **전국 단위 알림/정책/운영/모니터링, 장애/오류/예외 실시간 알림** // [FR-13, NFR-7]
- **정책/구조/권한 변경 이력, 감사/보안 로그, 권한 상승 방지** // [FR-1, FR-12, NFR-2]
- **전국 확장/조직 구조/정책/실적/통계 관리** // [FR-12, UC-3]
- (image: 전국 조직/정책/통계/감사/보안 대시보드 와이어프레임) // [와이어프레임/목업]

---

### 3. CityAdmin(시청 단위 관리자)

- **본인 시청 및 하위 구청/작업자/시민 관리** // [FR-3, UC-3]
- **시민 자가가입 승인/역할 전환, 시청별 정책/실적/통계/알림 관리** // [FR-2, FR-9, UC-4]
- **시청 단위 대시보드/통계/운영/감사, 타 시청 데이터 접근 불가** // [FR-4, FR-10, NFR-9]
- **회원/작업자/계정 등록/수정/삭제, 엑셀 대량 등록/다운로드** // [FR-3, UC-3, FR-10]
- **권한/역할/배정 관리, 승인/이력/감사 로그** // [FR-1, FR-2, FR-12, UC-3]
- **중복/삭제/권한 오류 등 실무적 예외 처리, 쉬운 안내/오류 메시지** // [FR-3, FR-12, UC-3, 쉬운 안내/오류 메시지]
- **시청 단위 알림/정책/운영/모니터링, 장애/오류/예외 실시간 알림** // [FR-13, NFR-7]
- **시민 승인/역할 전환, 실적/정산/통계 연동** // [FR-2, FR-9, UC-3, UC-4]
- (image: 시청별 조직/작업자/시민/통계/알림 대시보드 와이어프레임) // [와이어프레임/목업]

---

### 4. DistrictAdmin(구청 단위 관리자)

- **본인 구청 및 하위 작업자/시민 관리, 타 구청/시청 데이터 접근 불가** // [FR-3, UC-3]
- **작업자(조사자/청소자/수거자) 계정 생성/배정/관리, 구청별 실적/배정/통계/알림** // [FR-9, FR-10, UC-2]
- **구청 단위 대시보드/통계/운영/감사, 실적/정산/통계 연동** // [FR-4, FR-10, NFR-9]
- **회원/작업자/계정 등록/수정/삭제, 엑셀 대량 등록/다운로드** // [FR-3, UC-3, FR-10]
- **권한/역할/배정 관리, 승인/이력/감사 로그** // [FR-1, FR-2, FR-12, UC-3]
- **중복/삭제/권한 오류 등 실무적 예외 처리, 쉬운 안내/오류 메시지** // [FR-3, FR-12, UC-3, 쉬운 안내/오류 메시지]
- **구청 단위 알림/정책/운영/모니터링, 장애/오류/예외 실시간 알림** // [FR-13, NFR-7]
- **작업자 실적/정산/통계 연동, 배정/이력/감사 로그** // [FR-9, FR-10, UC-2, UC-4]
- (image: 구청별 작업자/시민/실적/배정/통계/알림 대시보드 와이어프레임) // [와이어프레임/목업]

---

## 작업자(Worker) 주요 업무/화면/UX 흐름

Beach-Saver의 작업자(조사자/청소자/수거자)는 아래와 같은 실무 기준 UX 및 업무 흐름에 따라 운영됩니다.

---

### 1. 공통: 로그인 및 계정/권한 관리

- **어르신 등 IT 미숙련자도 쉽게 사용할 수 있도록, 로그인은 '휴대폰 번호 + 인증번호(문자/음성)' 방식으로 구현** // [FR-1, FR-2, UC-3]
- 동일 휴대폰 번호로 여러 역할(조사자/청소자/수거자) 계정이 등록된 경우, **로그인 시 역할(작업자 유형) 선택 화면 제공 → 선택한 역할에 맞는 ID로 자동 로그인** // [FR-1, UC-3]
- **ID/비밀번호 직접 입력은 관리자/특수 계정만 예외 허용, 일반 사용자는 ID 직접 입력 불필요** // [FR-1, UC-3]
- 각 역할별(조사자/청소자/수거자) **별도 계정(아이디)로 로그인**(자동화) // [FR-1, UC-3]
- **자동 로그인/아이디 저장**: 쿠키/로컬스토리지 활용, 보안 정책(로그아웃/만료/다중기기) 적용 // [NFR-2, NFR-10]
- **수거자**: 차량 등록 여부에 따라 수거 관련 기능 자동 활성/비활성(미등록 시 경고/권한 제한) // [FR-3, UC-3, 차량 상세 정보: 종류/용량/검증]
- **권한 오류/중복 로그인/비정상 접근**: 실시간 안내 및 감사 로그 기록 // [FR-1, FR-12, UC-3, 쉬운 안내/오류 메시지]
- **오프라인 임시 저장/동기화 지원**: 네트워크 불안정 시 모든 입력/보고서/사진 등 임시 저장, 복구 시 자동 동기화 및 제출. // [NFR-9, FR-6, UC-1]
  - 예시: 현장(해안)에서 조사/청소/수거 중 네트워크 불안정 시 임시 저장, 온라인 복귀 시 자동 제출/동기화.
- (image: 로그인/역할선택/오류 안내 와이어프레임) // [와이어프레임/목업 추가 권장]

---

### 2. 조사자(Investigator) 업무/화면/UX

- **조사 보고서 작성**: 등록된 해안명, 동일 관리자 소속 worker(작업자) 드롭다운 선택 // [FR-6, UC-1]
- **동명이인 방지**: 이름+전화번호 끝자리로 중복 방지, 실명/PII는 별도 안전 저장 // [FR-1, UC-1]
- **자연재해/날씨 선택**: AI 학습/예측용 데이터 수집(날씨, 해양상황 등) // [FR-15, UC-6]
- **조사 시작/완료 시**: 서브 보고서의 시작/종료 위경도 자동 저장, GPS 오류 시 재시도/수동 입력 안내 // [FR-7, UC-1, 쉬운 안내/오류 메시지]
- **조사 해안길이 자동 계산**: 각 서브 보고서의 시작~종료 위경도 기반, 데이터 무결성 검증 // [FR-7, UC-1]
- **중복 보고/담당자(Claim) 정책**: 동일 구역/시간 중복 보고 차단, 담당자 지정/이력 기록 // [FR-1, FR-12, UC-3]
- **알림/피드백**: 보고서 제출/반려/승인 등 실시간 알림, 오류/예외 상황 안내 // [FR-13, UC-1, 쉬운 안내/오류 메시지]
- **오프라인 임시 저장/동기화 지원**: 네트워크 불안정 시 임시 저장, 복구 시 자동 동기화 // [NFR-9, FR-6, UC-1]
- (image: 조사 보고서 작성/오류 안내 와이어프레임) // [와이어프레임/목업 추가 권장]

---

### 3. 청소자(Cleaner) 업무/화면/UX

- **청소 보고서 작성**: 조사 기반 단건 처리(조사는 메인-서브 구조, 청소는 단일) // [FR-6, UC-1]
- **조사 결과 연동**: 조사 보고서 기반 자동 추천/배정, 미배정/중복 방지 // [FR-5, FR-12, UC-3]
- **GPS/사진 자동 기록**: 현장 데이터 자동화, 오류 시 예외 처리/재시도 // [FR-7, UC-1, 쉬운 안내/오류 메시지]
- **실적/보상/통계 연동**: 보고서 제출 시 실적 자동 집계, 관리자/팀장 확인 // [FR-9, FR-10, UC-2, UC-4, 나의 실적/정산 확인]
- **나의 실적/정산 확인**: 앱 내에서 누적 실적, 예상 보상, 정산 내역 실시간 확인 // [FR-9, FR-10, UC-2, UC-4]
- **청소 후 쓰레기 집하장(수거 포인트) 지정/기록**: **청소자는 청소 후 쓰레기를 임의의 집하장(수거 포인트)으로 모아놓고, 위치/사진/설명 등 집하장 정보를 청소 보고서에 기록(조사자 보고서에 없던 신규 집하장도 추가 가능)** // [FR-6, UC-1, 집하장 연동]
- **알림/피드백**: 업무 배정/변경/완료 등 실시간 알림, 오류/예외 안내 // [FR-13, UC-1, 쉬운 안내/오류 메시지]
- (image: 청소 보고서/집하장 지정/실적 확인/오류 안내 와이어프레임) // [와이어프레임/목업 추가 권장]
- (공통 오프라인 임시 저장/동기화 기능 활용)

---

### 4. 수거자(Collector) 업무/화면/UX

- **집하 보고서 작성**: 집하장소 직접 입력, GPS로 현재 위치 자동 저장, 미수신 시 수동 입력 안내 // [FR-6, UC-1, 쉬운 안내/오류 메시지]
- **청소자가 보고서에 기록한 집하장(수거 포인트) 정보 연동**: **수거자는 청소자가 보고서에 기록한 집하장(수거 포인트) 정보를 지도/리스트로 확인하고, 해당 장소를 순회하며 수거 작업 수행** // [FR-6, UC-1, 집하장 연동]
- **차량/업체/개인 구분/검증**: 미등록/미검증 시 기능 제한/경고, 관리자 승인 필요 // [FR-3, UC-3, 차량 상세 정보: 종류/용량/검증]
- **차량 상세 정보 등록**: 차량 종류(소형/대형/특수), 적재 용량, 업체/개인 구분, 검증 상태 등 // [FR-3, UC-3]
- **지도 기반 경로 관리**: 집하 보고서 기반 지도에 위치 표시, 경로 추가 시 중복/충돌 방지(다른 수거자 화면에서 색상 변경/비활성화) // [FR-8, UC-2]
- **실적/정산/통계 연동**: 수거 실적 자동 집계, 관리자/업체별 통계/정산 연동 // [FR-9, FR-10, UC-2, UC-4, 나의 실적/정산 확인]
- **나의 실적/정산 확인**: 앱 내에서 누적 실적, 예상 보상, 정산 내역 실시간 확인 // [FR-9, FR-10, UC-2, UC-4]
- **알림/피드백**: 업무 배정/경로 변경/완료 등 실시간 알림, 오류/예외 안내 // [FR-13, UC-1, 쉬운 안내/오류 메시지]
- (image: 집하 보고서/집하장 연동/차량 등록/실적 확인 와이어프레임) // [와이어프레임/목업 추가 권장]
- (공통 오프라인 임시 저장/동기화 기능 활용)

---

### 5. 공통 자동화/검증/보안 포인트

- **모든 주요 입력/기록(GPS, 위경도, 사진 등)은 자동화/무결성 검증 적용** // [FR-7, UC-1]
- **정책/권한/계정 구조(역할별 계정 분리, 차량 등록, 관리자 승인 등)와 100% 일치** // [FR-1, FR-3, UC-3]
- **실시간 알림/이력/감사 로그**: 모든 주요 이벤트(로그인, 보고서, 배정, 오류 등) 기록/알림 // [FR-13, UC-1, UC-3]
- **데이터 품질/보안**: PII/실명 안전 저장, 접근/변경/삭제 이력 감사, 예외/오류 실시간 안내 // [FR-1, NFR-2, UC-1, 쉬운 안내/오류 메시지]
- **엣지케이스**: GPS 미수신, 사진 업로드 실패, 중복 보고/배정, 권한 오류, 차량 미등록 등 실무적 예외 처리 // [FR-5, FR-6, FR-12, UC-1, UC-3]
- **오프라인 임시 저장/동기화 지원**: 네트워크 불안정 시 임시 저장, 복구 시 자동 동기화 // [NFR-9, FR-6, UC-1]
- **쉬운 안내/오류 메시지**: 모든 안내/경고/오류 메시지는 쉬운 언어, 큰 글씨, 시각적 강조, 예시/가이드 포함 // [NFR-3, UC-1, UC-3]
- **와이어프레임/목업**: 각 업무/화면/UX 흐름별로 실제 화면 구성(와이어프레임/목업) 추가 권장 // [실제 소통/협업/개발 효율 극대화]

---

## 프로젝트 진행 방식 및 개선 방향

- **프론트엔드 분리**: 관리자는 데스크탑(Next.js), 작업자는 모바일(React Native)로 별도 개발. 각 환경에 최적화된 UI/UX 및 기능(GPS, 사진 등) 제공
- **행정 조직 위계/현장 운영 반영**: 시청(superAdmin) → 구청(regularAdmin) → 작업자(조사자/청소자/수거자)로 이어지는 실제 행정 구조와 권한 분리
- **TDD(테스트 주도 개발) 강화**: 백엔드/프론트 모두 단위/통합 테스트를 우선 작성, 테스트 커버리지 및 자동화 기준 명확화
- **환경설정 분리**: dev, prod 등 환경별 .yml 파일 분리 관리로 운영/개발 환경 일관성 및 안전성 확보
- **interface/구현체 분리**: 도메인/서비스 계층에서 interface와 구현체를 명확히 분리, 확장성·유지보수성 강화
- **접근성(큰글씨 모드)**: 노인 등 시력이 약한 사용자를 위해 큰글씨/고대비 모드 등 접근성 기능 기본 제공
- **API 문서 자동화**: restDocs 등으로 API 명세 자동화, 보기 쉽고 공유 가능한 문서화 체계 구축
- **전국(타 지자체 등) 확장 가능성**: 모든 설계/운영/문서화 기준에 전국 확장(타 지자체, 민간 등) 가능성을 내재화

## 추가/보완 제안(실무 관점)

- **CI/CD 자동화**: GitHub Actions 등으로 빌드/테스트/배포 자동화, 코드 품질 및 배포 신뢰성 강화
- **코드리뷰/PR 규칙**: 팀 내 코드리뷰, PR 템플릿, 머지 기준 등 협업 프로세스 명확화
- **보안/인증 강화**: JWT/OAuth 등 인증, 환경변수/비밀정보 관리, 취약점 점검 프로세스 도입
- **접근성/국제화**: WCAG 기준 준수, 다국어(i18n) 지원 구조 설계
- **모노레포/멀티레포 전략**: 백엔드+프론트 통합(모노레포) 또는 분리(멀티레포) 운영 전략 검토
- **운영/모니터링**: 로그/모니터링/알람 체계, 장애 대응 프로세스 구축
- \*\*전국 확장(다도시/다시청) 및 조직/권한 구조

## 배포/운영 전략

- 모든 서비스(백엔드, 프론트)는 Docker 컨테이너로 실행 가능하게 설계
- 운영 환경(AWS, 온프레미스, 저비용 VPS 등)과 무관하게 동일한 Docker 이미지 사용
- 환경별 차이는 환경변수(.env), yml, config 파일로 분리 관리
- AWS 배포 시에도 Docker 이미지 그대로 활용(ECS, EC2, Lightsail 등)
- S3, RDS, 외부 서비스 연동 등은 config/환경변수로 분리
- 비용/운영 효율 고려해 초기에는 저비용 서버(온프레미스, 저가 VPS 등)에서 컨테이너 실행, 추후 AWS로 무중단 이전 가능
- Dockerfile, docker-compose, 환경변수 관리 표준화
- CI/CD로 이미지 빌드/배포 자동화 권장
- **전국 확장 시에도 동일한 배포/운영 전략 적용 가능하도록 설계**

---

이 디렉토리는 회사 수준의 협업과 장기 유지보수를 위한 백엔드 중심의 전체 문서화 체계를 관리합니다.

---

## 1. 문서화 목적

- 프로젝트의 기획, 설계, 운영, 협업 전 과정을 체계적으로 기록/공유
- 신규 인원 온보딩, 외부 공개, 장기 유지보수에 최적화
- 실무 기준의 명확한 산출물/가이드 제공
- **현재는 부산시(부산 해안)에서만 시범/운영 중이나, 전국(타 지자체 등)으로 확장 가능한 구조/비전임을 모든 문서화에 반영**
- **작업자 역할은 '조사자', '청소자', '수거자'로 분리되며, 한 사람이 여러 역할을 하려면 각 역할별 별도 계정(아이디)로 로그인해야 함. 수거자는 차량 필요, 개인/업체 모두 가능(구분/검증 필수).**

## 2. 문서화 진행 흐름

1. **기획(Planning)**
   - 프로젝트 목적/배경/비전, 요구사항, 유스케이스, 기능정의 등
2. **설계(Design)**
   - 시스템 아키텍처, DB/도메인 모델, API 명세, 시퀀스/흐름도 등
3. **운영(Operation)**
   - 환경설정, 배포/릴리즈, 테스트, 트러블슈팅, 운영 가이드 등
4. **협업(Collaboration)**
   - 코드 컨벤션, 기여/PR/이슈 가이드, 변경이력, 커뮤니케이션 규칙 등

## 3. 각 단계별 주요 산출물(예시)

| 단계 | 주요 문서/산출물 예시                                        |
| ---- | ------------------------------------------------------------ |
| 기획 | 프로젝트개요, 요구사항정의, 유스케이스, 기능명세             |
| 설계 | 아키텍처, DB설계(ERD), API명세, 도메인모델, 시퀀스다이어그램 |
| 운영 | 환경설정, 배포가이드, 테스트전략, 트러블슈팅                 |
| 협업 | 코드컨벤션, 기여가이드, 변경이력                             |

## 4. 문서화 원칙

- 실무/협업 기준의 구체적이고 명확한 작성
- 변경 이력, 참고 자료, 용어 정의 등은 각 문서 하단에 명시
- 문서간 상호 링크/참조 적극 활용
- 실제 코드/운영과 불일치 시 즉시 업데이트
- **전국 확장(타 지자체 등) 시에도 일관성/호환성 유지**
- **작업자 역할 분리, 계정 정책, 수거자 조건 등 실무적 구조를 모든 문서화에 반영(중복 설명은 상위 정책 참조로 간결화)**

---

> **참고:**
>
> - backend/README.md의 기존 내용(프로젝트 개요, 환경, 역할, 기능 등)은 각 docs 하위 문서로 세분화/이관 예정
> - v2에서는 문서 구조와 산출물의 일관성, 추적성, 실무 활용성을 최우선으로 관리

## 계정(아이디) 정책 및 생성 방식

- **작업자(조사자/청소자/수거자) 계정은 원칙적으로 관리자(시청/구청)가 직접 생성**
  - 단일 등록(개별 입력) 및 **엑셀 대량 업로드** 모두 지원
  - 수거자(차량 필요, 업체/개인 구분/검증 필수)는 반드시 관리자 직접 생성/검증
- **역할별 계정 정책의 UX**
  - 현 정책은 **조사자/청소자/수거자 역할별로 계정(아이디) 엄격 분리**를 원칙으로 함. (역할 전환 UI/통합 계정 등은 도입하지 않음)
  - 이는 각 역할의 업무가 자주 바뀌지 않고, 보안/감사/책임 분리의 실무적 필요성이 더 크다고 판단함.
- **시민 참여 확대를 위해 자원봉사자 등은 회원가입(자가 가입) 기능 제공**
  - 자가 가입 계정은 "임시 계정" 상태로 생성, **관리자 승인 후 정식 계정 전환**
  - 승인 전까지 주요 기능 제한(보고서 제출 등 불가)
  - **시민 참여자는 자가 가입 시 기본적으로 '자원봉사자' 역할로만 등록되며, 관리자 승인/배정 시점에만 '청소자'로 변경/확정됨. '조사자' 역할은 시민 참여로 부여할 수 없으며, 반드시 행정기관/전문 인력(관리자 직접 생성/배정)만 가능하다. '수거자' 역할 역시 시민 참여로 부여할 수 없으며, 반드시 관리자 직접 생성/배정만 허용함.**
  - **자원봉사자는 청소 업무에 배정되기 전까지 별도의 활동/권한이 없음(대기 상태). 본 시스템에서 자원봉사자는 '청소만 도와주는 시민'으로 정의함.**
- **아이디(계정명)는 시스템이 통일된 규칙에 따라 자동 생성/부여**

  - 닉네임(표시명)은 한글 포함 자유 입력(중복 허용), 실제 ID를 직접 입력할 일이 없으므로, ID 생성 시 닉네임이 한글이어도 영문 변환 없이 한글 그대로 사용 가능
  - 예: `[구분코드]_[닉네임]_[역할]_[고유번호]` (정규 작업자: `BSJ001_홍길동_CLEANER_0025`, 자원봉사자: `CITIZEN_김영희_VOLUNTEER_0178`)
  - **ID 생성 시 실명 등 PII(개인식별정보)는 절대 포함하지 않으며, 닉네임 기반으로만 자동 생성됨. 실명은 별도 안전 저장**
  - 사용자는 닉네임(표시명)만 자유롭게 입력, 아이디는 자동 생성/부여(로그인/운영/감사/통계 기준)
  - **고유번호(시퀀스/가입일시/랜덤 등)는 시스템이 자동 부여하며, ID의 유일성을 보장함**
  - **ID 생성 예시(역할별):**

    | 구분             | 닉네임  | 역할          | 구분코드     | 고유번호 | 최종 ID 예시                             |
    | ---------------- | ------- | ------------- | ------------ | -------- | ---------------------------------------- |
    | PlatformAdmin    | 관리자A | PLATFORM      | PLATFORM     | 0001     | PLATFORM\_관리자A_PLATFORM_0001          |
    | CityAdmin        | 김시청  | CITYADMIN     | BSJ001       | 0002     | BSJ001\_김시청\_CITYADMIN_0002           |
    | DistrictAdmin    | 박구청  | DISTRICTADMIN | BSJ001-HAEUN | 0003     | BSJ001-HAEUN\_박구청\_DISTRICTADMIN_0003 |
    | 조사자           | 이조사  | INVESTIGATOR  | BSJ001       | 0004     | BSJ001\_이조사\_INVESTIGATOR_0004        |
    | 청소자           | 홍길동  | CLEANER       | BSJ001       | 0025     | BSJ001\_홍길동\_CLEANER_0025             |
    | 수거자           | 최수거  | COLLECTOR     | BSJ001       | 0033     | BSJ001\_최수거\_COLLECTOR_0033           |
    | 자원봉사자(시민) | 김영희  | VOLUNTEER     | CITIZEN      | 0178     | CITIZEN\_김영희\_VOLUNTEER_0178          |

> **참고:**
>
> - 표의 백슬래시(\)는 마크다운에서 언더스코어(*)가 이탤릭 등으로 해석되는 걸 막기 위한 escape 문자입니다. 실제 시스템/DB/로그인 등에서는 백슬래시 없이 언더스코어만 사용합니다. (예: CITIZEN*김영희\_VOLUNTEER_0178)
> - 시청/구청 구분코드는 [시청코드]-[구청코드] 형식으로, 전국 확장/감사/통계/정산 등에서 조직별 구분을 명확히 하기 위함입니다. (예: BSJ001-HAEUN = 부산시-해운대구청)

- **ID 직접 입력 없는 로그인 정책**
  - 실제 로그인/인증은 "휴대폰 번호 + 인증번호(문자/음성)" 방식으로 구현(고령자/IT 미숙련자 배려)
  - 동일 휴대폰 번호로 여러 역할(조사자/청소자/수거자) 계정이 등록된 경우, 로그인 시 역할 선택 화면 제공(큰 글씨/쉬운 UI)
  - 동일 번호로 여러 계정이 없으면 바로 해당 계정으로 로그인
  - 사용자가 원하는 역할/계정을 선택하면, 해당 ID로 자동 로그인(내부적으로 ID/권한/실적/정산 등 세션 생성)
  - ID/비밀번호 직접 입력은 예외적 상황(관리자/특수 계정)에서만 허용, 일반 사용자는 ID 직접 입력 불필요
  - ID는 내부 식별/감사/통계용, 화면에는 닉네임/역할만 표시
  - 예외/분실/변경 등은 관리자/콜센터에서 지원
- **운영/보안/감사/통계 일관성 확보**
  - 모든 계정 생성/변경/승인/삭제 이력 로그 필수
  - 시민 참여 계정은 반드시 `CITIZEN_` 등 접두어로 구분
  - 아이디 변경 불가(닉네임만 변경 허용)
  - 생성 방식(관리자/자가가입), 역할, 소속, 생성일 등 메타데이터 필수 저장

---

## FAQ/운영 정책(휴대폰 번호 변경·공유·인증 보안)

- **휴대폰 번호 변경**: 본인 인증(기존/신규 번호) 및 관리자 승인 후 계정/이력/권한을 안전하게 이관, 모든 변경 이력은 감사/보안 목적으로 기록. 예외(번호 분실 등)는 관리자/콜센터에서 신분증 등 추가 인증 후 처리
- **번호 공유/재할당/중복**: 휴대폰 번호는 1인 1계정 원칙(가족/공유 불가). 동일 번호 중복 등록 시 관리자 승인/검증 필수. 통신사 번호 재할당 등으로 인한 계정 충돌/오용 발생 시 최초 로그인 시 추가 본인 인증 및 관리자 확인 절차 적용. 계정 충돌/오용 이력은 모두 기록, 필요시 관리자/콜센터에서 분리/병합/삭제 등 조치
- **인증번호(SMS/음성) 보안**: 인증번호는 6자리 이상 난수/1회용, 3~5분 내 자동 만료. 5회 이상 인증 실패 시 일정 시간 잠금, 과도한 요청 시 관리자 알림. 인증번호는 서버에 암호화 저장, 만료 즉시 삭제. SMS/음성/간편 인증 등 다양한 채널 지원

> 위 정책은 실제 운영/보안/감사/UX까지 모두 고려한 실무 기준임.

---

## 전국 확장(다도시/다시청) 및 조직/권한 구조

- **조직(Organization) 구조 도입:**
  - PlatformAdmin(플랫폼 운영사, 전체 시스템 최고 관리자)
  - CityAdmin(시청 단위 관리자, 예: 부산시청, 서울시청)
  - DistrictAdmin(구청 단위 관리자, 예: 해운대구청)
  - Worker(작업자: 조사자/청소자/수거자), Citizen(시민/자원봉사자)
- **조직별 계층 구조:**
  - PlatformAdmin → CityAdmin(시청) → DistrictAdmin(구청) → Worker(작업자)
- **권한/업무 범위:**

| 역할                | 관리/조회 가능 범위              | 계정 생성/관리 | 데이터(로그/통계) 접근 | 주요 업무/기능 예시                        |
| ------------------- | -------------------------------- | -------------- | ---------------------- | ------------------------------------------ |
| PlatformAdmin       | 전체 조직(모든 시청/구청/작업자) | O              | 전체                   | 전체 조직/계정/로그/통계 관리, 정책 변경   |
| CityAdmin           | 본인 시청 및 하위 구청/작업자    | O              | 본인 시청 이하         | 구청/작업자 계정 관리, 시청 단위 통계/감사 |
| DistrictAdmin       | 본인 구청 및 하위 작업자         | O              | 본인 구청 이하         | 작업자 계정 관리, 구청 단위 통계/감사      |
| Worker(조사자)      | 본인 업무(조사 데이터)만         | X              | 본인 데이터만          | 현장 조사, 데이터 입력/수정                |
| Worker(청소자)      | 본인 업무(청소 데이터)만         | X              | 본인 데이터만          | 현장 청소, 데이터 입력/수정                |
| Worker(수거자)      | 본인 업무(수거 데이터)만         | X              | 본인 데이터만          | 수거/운반, 데이터 입력/수정                |
| Citizen(자원봉사자) | 본인 업무(청소 데이터)만         | X              | 본인 데이터만          | 청소 참여, 데이터 입력(승인 전 제한)       |

- **PlatformAdmin**: 전체 시스템(모든 시청/구청/작업자) 관리, 정책/구조 변경, 전체 데이터 접근(운영사/플랫폼사 전용)
  - **전국 확장 초기에는 PlatformAdmin이 모든 데이터에 접근 가능하며, 실제 운영 상황/보안 이슈 발생 시 점진적으로 접근 범위를 제한하는 정책을 적용할 예정임.**
- **CityAdmin**: 본인 시청 및 하위 구청/작업자 관리, 시청 단위 통계/감사, 타 시청 데이터 접근 불가
- **DistrictAdmin**: 본인 구청 및 하위 작업자 관리, 구청 단위 통계/감사, 타 구청/시청 데이터 접근 불가
- **Worker(조사자/청소자/수거자)**: 본인 계정으로 할당된 업무 데이터만 접근/수정 가능, 타 작업자 데이터 접근 불가
- **Citizen(자원봉사자)**: 본인 계정으로 입력한 청소 데이터만 접근/수정 가능(승인 전 제한), 관리자 승인 후 정식 청소자 권한 부여

- **조직(시청/구청) 간 데이터/계정/로그 절대 분리(보안/감사 목적)**
- **권한 상승(Privilege Escalation) 방지**: 관리자 권한 변경은 이중 승인 및 감사 로그 필수
- **업무 위임/대리 처리**: 위임 시 위임자/수임자 모두 감사 로그 기록, 위임 범위 제한
- **시민 계정 승인 전 기능 제한**: 승인 전에는 데이터 입력만 가능, 조회/수정/통계 등 제한

---

## 자원봉사자(시민) 관리 주체 정책

- 자원봉사자(시민) 계정의 **최초 승인/역할 전환은 시청(CityAdmin)**이 담당하며,
- **실제 업무 배정/현장 관리는 구청(DistrictAdmin)**이 담당함.

| 단계           | 주체                | 주요 업무/권한                                |
| -------------- | ------------------- | --------------------------------------------- |
| 가입/승인      | 시청(CityAdmin)     | 시민 자가 가입 계정 승인, 역할 전환(청소자)   |
| 업무 배정/관리 | 구청(DistrictAdmin) | 자원봉사자(청소자) 배정, 현장 관리, 실적 확인 |

- 시민 자가 가입 → 시청 승인(청소자 전환) → 구청 배정/관리 순으로 진행
- 승인/역할 전환, 배정/실적 등 모든 이력은 시청/구청별로 분리 기록
- **관리자 승인 시 시스템상 역할이 '청소자'로 영구 전환됨(단, 필요시 업무별 임시 권한 부여 정책도 검토 가능)**

## 알림(Notifications) 기능 정책 및 시나리오

- Beach-Saver는 실무/운영 효율성, 협업, 감사 기준을 위해 알림(Notifications) 기능을 필수적으로 지원함
- 알림은 계정 승인, 역할 변경, 업무 배정, 보고서 상태, 긴급 공지, 통계/정책, 오류/예외, 감사/보안 등 다양한 상황에서 자동/수동으로 발송됨

| 구분        | 트리거/상황 예시                           | 수신자(역할)             | 채널(방법)        |
| ----------- | ------------------------------------------ | ------------------------ | ----------------- |
| 계정 승인   | 시민 자가 가입 → 관리자 승인 필요          | CityAdmin, Citizen       | 앱푸시, 이메일    |
| 역할 변경   | 시민→청소자 전환, 작업자 배정/해제         | Citizen, Worker, Admin   | 앱푸시, 이메일    |
| 업무 배정   | 작업자에게 새 업무(청소/조사/수거) 할당    | Worker                   | 앱푸시, SMS       |
| 보고서 상태 | 보고서 제출/반려/승인                      | Worker, DistrictAdmin    | 앱푸시, 이메일    |
| 긴급 공지   | 기상특보, 현장 위험, 시스템 점검 등        | 전체/특정 역할           | 앱푸시, SMS, 배너 |
| 통계/정책   | 월간/주간 통계, 정책 변경, 시스템 업데이트 | CityAdmin, DistrictAdmin | 이메일, 앱푸시    |
| 오류/예외   | GPS 오류, 사진 업로드 실패, 데이터 누락 등 | Worker                   | 앱푸시, 인앱팝업  |
| 감사/보안   | 권한 변경, 비정상 접근, 데이터 삭제 등     | PlatformAdmin, CityAdmin | 이메일, 대시보드  |

- **역할별 구독/수신 범위**: 시민은 본인 계정/업무 관련, 작업자는 배정/보고서/오류, 관리자/감사자는 전체/정책/보안 등
- **채널별 우선순위/중복 방지**: 중요도 따라 앱푸시/이메일/SMS/인앱팝업 등 다중 채널 지원, 중복/스팸 방지 정책 필요
- **알림 이력/로그**: 모든 알림 발송/수신 이력 DB 기록(감사/분쟁/재전송 등)
- **알림 설정/구독 관리**: 사용자별 알림 on/off, 채널 선택, 중요도별 구독 설정 등 지원
- **API/모듈화**: 알림 발송/수신/읽음처리/이력조회 등 API/모듈로 분리(확장성/유지보수성 강화)

### 실무/엣지케이스

- 대량 알림 발송 시 성능/지연/실패 처리
- 알림 미수신(앱 삭제, 푸시 차단 등) 시 재전송/대체 채널
- 개인정보/보안(민감정보 포함 시 암호화/접근제어)
- 법적/감사 기준(알림 이력 보관, 발송 실패/성공 로그)

### 문서화/설계 반영 방안

- 요구사항/유스케이스/DB설계/API 명세 등 모든 산출물에 알림 정책/흐름/테이블/시퀀스 다이어그램 등 반영

---

## 업무 배정/진행 자동화 원칙

- **정기/반복/일상 업무**: 시스템이 자동 배정/승인/알림, 관리자는 예외 상황만 개입
- **시민 자원봉사자(청소자)**: 자율 신청→자동 승인→참여→실적 자동 집계, 필요시만 관리자 승인/거절
- **특수/긴급/분쟁/초과 등 예외 상황**: 관리자 직접 개입/승인/조정
- **모든 단계의 자동화/자율화 이력은 기록, 필요시 감사/통계/분석에 활용**
- **관리자 개입 최소화로 운영 효율/확장성/시민 참여 활성화 보장**

> **정책/DB/유스케이스/시스템 설계에 반드시 '자동화/자율화 우선, 관리자 개입 최소화' 원칙을 반영할 것.**

---

## 업무 배정 정책(실무/확장성 기준)

| 역할                    | 기본 배정 방식              | 자동화/자율 배정 | 실무 권장/비고                                     |
| ----------------------- | --------------------------- | ---------------- | -------------------------------------------------- |
| 조사자                  | 관리자 직접 배정(원칙)      | 반복/정기 업무   | 스케줄러/자동 배정 시스템 도입, 예외만 수동 배정   |
| 정규 청소자(상시/계약)  | 관리자 직접 배정(정기/특수) | 반복/정기 업무   | 구청/용역/외주 등, 정기적 실적/평가/정산 연동      |
| 시민 자원봉사자(청소자) | 자율 신청/오픈 슬롯제(기본) | 자동 매칭/승인   | 일반 시민, 자율 참여, 봉사 실적 위주, 승인 전 제한 |
| 수거자                  | 관리자 직접 배정(원칙)      | 반복/정기 업무   | 차량/경로/안전 등 고려, 정기 수거는 자동화         |

- **조사자/수거자**: 관리자 직접 배정이 원칙(정확한 구역/시기/책임 필요). 단, 반복/정기 업무는 스케줄러/자동 배정 시스템으로 효율화, 긴급/특수 업무만 수동 배정.
- **정규 청소자(상시/계약)**: 구청/용역/외주 등 소속, 관리자 직접 배정(정기/특수), 반복/정기 업무는 자동화, 실적/평가/정산 연동.
- **시민 자원봉사자(청소자 역할)**: 자율 신청/오픈 슬롯제/자동 매칭이 기본, 관리자는 승인/거절만 담당(혹은 자동 승인), 필요시만 직접 배정, 봉사 실적 위주, 승인 전 제한.
- **공통**: 업무 배정/신청/자동화 이력은 모두 기록, 결원/미수행 시 알림/재배정 기능 필수.
- **향후**: AI 기반 자동 추천/배정, 작업자 가용성/이력 기반 최적화 기능 확장 가능.

> **정규 청소자와 시민 자원봉사자(청소자 역할)는 권한/배정/실적/정책상 명확히 분리되어야 하며, 모든 정책/DB/유스케이스/문서화에 이 구분을 반드시 반영할 것.**

---

## 조사 결과 기반 청소 업무 배정 정책

- 조사자가 등록한 청소 필요 구역/일정에 대해 **정규 청소자 우선 배정, 남는 인원/슬롯에 시민 자원봉사자(청소자) 자율 신청(선착순/대기)** 원칙 적용
- 필요시 정규 청소자용 슬롯과 시민 자원봉사자용 슬롯을 별도 운영할 수 있음(정책/운영 목적에 따라 선택)
- 구역/일정별 최대 인원, 우선순위, 자동/수동 승인 등 정책 조합 가능
- 모든 배정/신청/실적 이력은 정규/시민 청소자별로 구분 기록, 책임/보상/실적/통계 등에도 반영

| 구분                    | 배정 우선순위/정책 예시                                     |
| ----------------------- | ----------------------------------------------------------- |
| 정규 청소자             | 조사 결과 기반 우선 자동/수동 배정, 반복/정기 업무 자동화   |
| 시민 자원봉사자(청소자) | 정규 청소자 배정 후 남는 슬롯에 한해 자율 신청(선착순/대기) |
| 별도 슬롯 운영          | 필요시 정규/시민 청소자용 슬롯을 완전히 분리하여 운영 가능  |

> **실제 정책/DB/유스케이스/통계 설계에 반드시 이 구조와 우선순위 정책을 반영할 것.**

---

## 중복 보고/처리 방지 및 담당자(Claim) 정책

- 동일 현장/구역/이슈(쓰레기, 조사, 청소, 수거 등)는 1명(또는 1팀)만 "담당(Claim)" 가능
- 담당자가 확정되면 해당 업무는 "진행 중" 상태, 타 작업자는 신청/보고 불가(또는 대기/협업)
- 시스템이 GPS/시간/이슈 유형 등으로 중복 여부 자동 체크, 중복 보고 시 안내/차단
- 필요시 관리자 승인/병합/예외 처리 가능
- 팀 단위 처리 시 팀장/팀원 지정, 실적/보상/책임 분배 명확화

> **정책/DB/시스템/유스케이스/문서화에 반드시 중복 방지 및 Claim(담당자) 정책을 반영할 것.**

---

## 팀 단위 처리 정책 및 실무 업무 흐름

Beach-Saver는 현장 효율성과 실적/보상/책임의 명확한 분배를 위해 팀 단위(팀장/팀원) 기반의 업무 처리를 지원합니다.

### 1. 팀 구성 및 역할/권한

- **팀장(조장)**: 관리자 직접 지정, 자율 신청/선출, 또는 시스템 자동 배정(경력/실적 등 기준)
  - 팀장 권한: 팀원 관리, 공식 보고/완료 처리, 실적/보상 분배, 팀원 교체/해체 요청, 이의제기/의견 취합
- **팀원**: 관리자 지정, 자율 신청, 자동 매칭(가용 인력/경력/위치 등 기준)
  - 팀원 권한: 현장 자료/의견 첨부, 이의제기/의견 제출, 실적/보상 기여
- **팀 구성/변경/해체 이력은 모두 기록, 감사/통계/분쟁 시 활용**

### 2. 팀 단위 공식 업무/보고 프로세스

- **팀원**: 현장 자료(사진, 위치, 의견 등) 첨부만 가능, 공식 보고/완료 처리는 불가
- **팀장**: 팀원 자료 취합·검토 후 공식 보고/완료 처리(팀장도 현장 자료 첨부 가능)
- **공식 보고/완료 처리**: 팀장만 가능, 모든 첨부/기여 이력은 기록·실적/보상/봉사시간에 반영
- **팀원 이의제기/의견 경로**: 팀원은 시스템 내 이의제기/의견 제출 경로를 통해 관리자에게 직접 의견/문제 제기 가능(이력 기록)

### 3. 실적/보상/기여도 분배

- **팀장은 전체 실적/책임의 1/N 이상, 리더십/관리 실적 별도 집계, 문제 발생 시 1차 책임**
- **팀원은 참여 실적/보상 1/N 또는 역할별 차등, 실적/보상/봉사시간 등 명확히 분배**
- **기여도 분쟁/이의제기 발생 시 관리자/감사자가 이력/첨부자료 기반으로 조정**

### 4. 팀 단위 엣지케이스 및 예외 처리

- **팀원 교체/추가/해체**: 팀장/관리자 요청, 시스템 자동(이탈/결원 등), 모든 변경 이력 기록
- **팀 해체/재구성**: 업무 미수행/분쟁/실적 미달 등 사유 발생 시 관리자/팀장/시스템이 해체/재구성 가능
- **기여도 분쟁/이의제기**: 실적/보상/기여도에 대한 이의제기 시 관리자/감사자가 이력/첨부자료 기반으로 판단
- **팀장 부재/이탈**: 자동 팀장 승계(경력/실적 기준), 관리자 지정, 임시 팀장 지정 등 정책 적용

### 5. DB/시스템 설계 포인트

- 업무(이슈) 테이블에 "팀ID", "팀장ID", "팀원ID 리스트", "팀 역할/권한", "기여도/실적/보상 분배" 등 필드 추가
- 팀 구성/변경/해체 이력 테이블 별도 관리, 공식 보고/첨부자료/이의제기 이력 모두 기록
- 실적/보상/봉사시간 자동 집계, 기여도 분쟁/이의제기 처리 로직 구현

### 6. 실제 시나리오 예시

- **예시1:** 팀장A, 팀원B/C가 한 구역 청소 업무를 배정받음 → 팀원B/C가 현장 사진/의견 첨부 → 팀장A가 자료 취합·검토 후 공식 보고/완료 처리 → 실적/보상 1/N 분배, 이력 기록
- **예시2:** 팀원C가 현장 참여 불가로 교체 요청 → 팀장A가 시스템에서 교체 신청 → 관리자 승인 후 팀원D로 교체, 이력 기록
- **예시3:** 팀원B가 실적/보상 분배에 이의제기 → 시스템 내 이의제기 제출 → 관리자/감사자가 첨부자료/이력 검토 후 조정

> **정책/DB/시스템/유스케이스/문서화에 반드시 팀 단위 처리 구조와 공식 보고/실적/보상/이의제기/감사/보안 정책을 반영할 것.**

---

## 전체 업무 흐름(조사자→청소자→수거자)

1. **조사자(Investigator)**: 해안 쓰레기 현황만 조사, 조사 보고서 작성/제출(집하장 정보 입력 없음)
2. **청소자(팀 단위)**: 조사 보고서 기반 청소, 청소 보고서 작성(팀 단위, 팀장 일괄 확정), 청소 후 임의의 집하장에 쓰레기를 모아 별도 '수거용 보고서' 작성(집하장 위치/사진/설명 등 포함, 청소 보고서에는 집하장 정보 입력 X)
3. **수거자(Collector)**: 청소자가 올린 '수거용 보고서'만 보고 현장 이동, 수거 작업 후 각 집하장별 '수거 완료' 버튼(수거자만 클릭 가능)으로 프로세스 종료(완료 시 사진/위치/상태 등 기록)

---

### 트리/타임라인/상세 리스트 구조 예시(최신 정책)

```text
[조사 보고서 #123]
  └─ [청소 보고서 #A] (팀장/팀원, 전/후 사진, 팀원별 자료)
      └─ [수거용 보고서 #X] (집하장 #1, #2, 위치/사진/설명)
          └─ [수거 완료] (수거자만 클릭, 완료 시 사진/위치/상태 등 기록)
```

- **조사 보고서**: 구역/포인트, 위치, 사진, 특이사항 등(집하장 정보 없음)
- **청소 보고서**: 팀/팀원, 각 팀원별 청소 전/후 사진, 첨부자료, 실적, 상태, 팀장, 제출/확정/승인 이력 등(집하장 정보 없음)
- **수거용 보고서**: 집하장별 위치/사진/설명 등(청소자가 별도 작성/제출)
- **수거 완료 처리**: 집하장별 상태 등(수거자만 '수거 완료' 가능, 완료 시 사진/위치/상태 등 기록)

---

### 작업자(Worker) 주요 업무/화면/UX 흐름(최신 정책)

- **청소 보고서 작성**: 팀 단위로 1건만 생성, 팀원들이 각자 자료(사진, 상태 등) 계속 추가/수정(실시간 동기화)
- **팀장 일괄 확정**: 팀장이 전체 자료를 취합·검토 후 한 번에 '최종 확정(제출/승인 요청)'
- **조사 결과 연동**: 조사 보고서 기반 자동 추천/배정, 미배정/중복 방지
- **GPS/사진 자동 기록**: 현장 데이터 자동화, 오류 시 예외 처리/재시도
- **실적/보상/통계 연동**: 보고서 제출 시 실적 자동 집계, 관리자/팀장 확인
- **나의 실적/정산 확인**: 앱 내에서 누적 실적, 예상 보상, 정산 내역 실시간 확인
- **수거용 보고서 작성**: 청소 후 임의의 집하장에 쓰레기를 모아, 별도 '수거용 보고서'에서만 집하장 정보 입력(청소 보고서에는 입력 X)
- **수거 완료 처리**: 수거자는 '수거용 보고서'만 보고 현장 이동, 각 집하장별 '수거 완료' 버튼(수거자만 클릭 가능)으로 프로세스 종료(완료 시 사진/위치/상태 등 기록)
- **알림/피드백**: 업무 배정/변경/완료 등 실시간 알림, 오류/예외 안내
- (공통 오프라인 임시 저장/동기화 기능 활용)

#### 실무상 주의점/엣지케이스

- 조사자는 집하장 정보 입력 불가(정책상 금지)
- 청소 보고서에는 집하장 정보 입력 X, 반드시 별도 수거용 보고서에서만 집하장 정보 입력
- 수거자는 수거용 보고서만 보고 업무, '수거 완료' 버튼은 수거자만 노출/1회만 가능(중복 방지)
- 집하장 정보 누락/오류: 수거용 보고서 제출 전 검증(미기재시 제출 불가)
- 수거 완료 시 자동 타임스탬프/위치/사진 기록(정책에 따라 필수/선택)
- 모든 단계별 보고서/상태/첨부자료는 독립적으로 저장, 논리적으로 연결(참조)
- 관리자/대시보드에서 조사~청소~수거 전체 이력/상태/첨부자료를 트리/타임라인/지도 등으로 통합 조회

---

## 인증/로그인 정책

### 1. 기본 정책

- 기본: 휴대폰 인증(인증번호 발송, **카카오톡 알림톡(기본), SMS(예외)**)
- 인증번호 발송 채널: **카카오톡 알림톡(기본), SMS(예외)**
- **SSO(카카오/네이버/구글 등) 간편 로그인은 현재 미지원**
  - 실무적 근거: 1) 핸드폰 인증만으로도 전국 확장/공공기관/고령자/현장 작업자 UX에 최적화, 2) 1번호:N계정(역할 선택) 구조와 SSO(1:1 매핑) 혼합 시 계정/권한/운영/보안 복잡성↑, 3) SSO 연동/검수/개인정보 동의/탈퇴 등 외부 이슈, 4) 실제 현장/운영/보안/감사 기준에 부합하지 않음
  - SSO는 실제 필요/수요/운영 여건 발생 시에만 도입 검토(그때 정책/DB/UX/보안 등 전면 재설계)
- 인증/로그인 정책은 "휴대폰 인증(번호+인증번호, **카카오톡 알림톡(기본), SMS(예외)** 발송) + 역할 선택"만 지원(1번호:N계정 구조)

### 2. 카카오톡 알림톡/싱크 도입 이유

- 비용: 알림톡(건당 8~10원) < SMS(건당 10~30원)
- 성공률: 알림톡 > SMS(스팸/실패 적음)
- UX: 알림톡은 카카오톡 앱으로 바로 인증번호 확인, SMS는 스팸함/지연/실패 빈번
- 템플릿 등록/심사 필요(최초 1~2일, 이후 자동화)

### 3. SMS fallback 정책

- 카카오톡 미설치/미가입/해외 사용자는 SMS로 인증번호 발송
- SMS는 비용/성공률/스팸 이슈로 예외 fallback 용도만 사용

### 4. SSO(카카오/네이버/구글 등) 도입 정책

- (현재 미지원, 향후 필요시 도입 가능)
- OAuth2 기반 SSO 지원은 실제 필요/수요/운영 여건 발생 시에만 검토
- 도입 시 정책/DB/UX/보안 등 전면 재설계 필요

### 5. 인증/로그인 전체 흐름

1. 사용자가 휴대폰 번호 입력 → 인증번호 요청
2. 서버가 **카카오톡 알림톡(기본)** 또는 **SMS(예외)**로 인증번호 발송
3. 사용자가 인증번호 입력 → 서버에서 검증 후 JWT 발급

### 6. 운영/보안 팁

- 카카오 알림톡 템플릿 연동은 각 플랫폼 개발자센터 등록/검수 필요
- SMS는 비용/성공률/스팸 이슈로 예외 fallback 용도만 사용
- SSO+휴대폰 인증 병행 시, 계정 중복/통합 정책 명확히(단, 현재는 SSO 미지원)

---

## 정책/업무 흐름/용어/ID/문서 간 참조 체계 (2024-06 최신)

- 본 README의 정책/업무 흐름/용어/ID/다이어그램/테이블은 모든 하위 문서(1-1~2-3)에서 반드시 상위 정책으로 참조됨을 명시.
- 중복 설명은 최소화하고, 하위 문서에서는 반드시 "상위 정책 [[README]] 참조" 등으로 일관성 유지.
- 정책/업무 흐름/용어/ID/관계/예외/엣지케이스 등은 변경 시 전 문서/설계/코드/운영에 즉시 반영, 변경 이력 명확히 기록.
- 전국 확장/공공기관/고령자/현장 작업자 UX/보안 기준, 실무적 예외/엣지케이스/운영/보안 팁 등은 본 정책에 포함.

---
